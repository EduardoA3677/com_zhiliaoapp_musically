precision highp float;uniform vec2 uResolution;varying float vTime;varying vec2 vTexCoord;uniform float uLightness;uniform vec2 uPosition,uScale;uniform vec3 uColor1,uColor2,uColor3,uColor4,uBgColor;uniform float uComplex,uMorph;
#define PI 3.14159265359
float p(vec2 u){const vec3 v=vec3(-.866025404,.5,.577350269);u=abs(u);u-=2.*min(dot(v.xy,u),0.)*v.xy;u-=vec2(clamp(u.x,-v.z*.39,v.z*.39),.39);return length(u)*sign(u.y)-.1;}vec2 p(vec2 v,float u){float f=cos(u);u=sin(u);return vec2(f*v.x-u*v.y,u*v.x+f*v.y);}float v(vec2 u){u=p(u,PI/6.);return p(u);}vec2 t(vec2 u){vec2 v=vec2(1,sqrt(3.)),f=mod(u,v)-v*.5;v=mod(u-v*.5,v)-v*.5;return length(f)<length(v)?f:v;}vec2 n(vec2 u){vec2 v=vec2(1,sqrt(3.));return length(mod(u,v)-v*.5)<length(mod(u-v*.5,v)-v*.5)?floor(u/v):floor((u-v*.5)/v);}mat2 n(float u){return mat2(cos(u),-sin(u),sin(u),cos(u));}float n(vec2 u,float v,float f,float m){return step(f,fract(sin(dot((u+vec2(m)).xy,vec2(12.9898,78.233)))*43758.5453123));}vec3 n(vec2 u,float v,float f){float m=length(u)*3.,s=atan(u.y,u.x),r=uComplex,x=(1.-uMorph)*sin(r*0.*s+.01)+.3*sin(r*.5*s+1.5);r=mod(atan(u.y,u.x)+v*8.+f+PI,2.*PI);s=r/(PI*.5);int y=int(s);s=fract(s);return vec3(mix(uBgColor,mix(uBgColor,mix(mix(mix(mix(vec3(0),mix(uColor1,uColor2,s),step(float(y),.5)*step(-.5,float(y))),mix(uColor2,uColor3,s),step(float(y),1.5)*step(.5,float(y))),mix(uColor3,uColor4,s),step(float(y),2.5)*step(1.5,float(y))),mix(uColor4,uColor1,s),step(2.5,float(y))),clamp((1.-smoothstep(x,x+1.,m)+(1.-smoothstep(x,x+3.5,m))*.1)*smoothstep(-.1,.7,m),0.,1.)),m*2.));}void main(){vec2 u=(vTexCoord-.5)*2.;u.x*=uResolution.x/uResolution.y;vec2 y=n(PI)*(vec2(u.x/uScale.x-uPosition.x,u.y/uScale.y+uPosition.y)*3.2),f=n(y);float s=vTime,m=v(t(y)),r=2./min(uResolution.x,uResolution.y)*3.2;m=1.-smoothstep(-r*.01,r*.01,m);y=vec2(u.x/uScale.x-uPosition.x,u.y/uScale.y+uPosition.y)*.2;vec3 x=n(y*2.,s,0.),c=n(y,s,0.),P=n(y,s,2.1),z=n(y,s,4.14);x=c*(n(f,s,.1,.39)*.15*m)+P*(n(f,s,.7,10.9)*.3*m)+z*(n(f,s,.9,8.8)*.4*m);if(uLightness>0.)x=mix(x,vec3(1),uLightness);else if(uLightness<0.)x=mix(x,vec3(0),-uLightness);gl_FragColor=vec4(vec3(x),1);}